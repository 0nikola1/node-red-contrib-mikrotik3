<script type="text/javascript">
    RED.nodes.registerType('mikrotik-device', {
        category: 'config',
        defaults: {
            host: { value: '192.168.0.1', required: true },
            port: { value: 8728, required: true, validate: RED.validators.number() },
            username: { value: 'admin' },
            password: { value: '' }
        },
        label: function () {
            debugger;
            if (!!this.username)
                return this.username + '@' + this.host + ':' + this.port;
            else
                return this.host + ':' + this.port;
        },
        credentials: {
            secusername: { type: "text", required: true },
            secpassword: { type: "password", required: true },
        },
        oneditprepare() {
            // migrate old non secure credentials in the form            
            if (!this.credentials)
                this.credentials = {};

            if (!this.credentials.secusername) {
                this.credentials.secusername = this.username;
                this.credentials.secpassword = this.password;
                $("#node-config-input-secusername").val(this.username);
                $("#node-config-input-secpassword").val(this.password);
            }
        },
        oneditsave() {
            // take care to fully remove the non secured saved credentials
            this.username = null;
            this.password = null;
        }
    });
</script>

<html type="text/x-red" data-template-name="mikrotik-device">
    <div class="form-row">
        <label for="node-config-input-host"><i class="fa fa-server"></i> Host</label>
        <input type="text" id="node-config-input-host">
    </div>
    <div class="form-row">
        <label for="node-config-input-port"><i class="fa fa-server"></i> Port</label>
        <input type="text" id="node-config-input-port">
    </div>
    <div class="form-row">
        <label for="node-config-input-username"><i class="fa fa-user"></i> Username</label>
        <input type="text" id="node-config-input-secusername">
    </div>
    <div class="form-row">
        <label for="node-config-input-password"><i class="fa fa-key"></i> Password</label>
        <input type="password" id="node-config-input-secpassword">
    </div>
</html>